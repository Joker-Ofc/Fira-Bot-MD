const ytdl=require("ytdl-core"),yts=require("yt-search"),axios=require("axios");function bytesToSize(e){return new Promise(((t,i)=>{const a=["Bytes","KB","MB","GB","TB"];if(0===e)return"n/a";const o=parseInt(Math.floor(Math.log(e)/Math.log(1024)),10);0===o&&t(`${e} ${a[o]}`),t(`${(e/1024**o).toFixed(1)} ${a[o]}`)}))}function ytMp4(e){return new Promise((async(t,i)=>{ytdl.getInfo(e).then((async e=>{let i=[];for(let t=0;t<e.formats.length;t++){let a=e.formats[t];if("mp4"==a.container&&1==a.hasVideo&&1==a.hasAudio){let{qualityLabel:e,contentLength:o,approxDurationMs:l}=a,n=await bytesToSize(o);i[t]={video:a.url,quality:e,size:n,duration:formated(parseInt(l))}}}let a=i.filter((e=>null!=e.video&&null!=e.size&&null!=e.quality)),o=a[0].video,l=e.videoDetails.title,n=e.videoDetails.description,r=parseInt(e.videoDetails.viewCount||0),s=e.videoDetails.likes,d=e.videoDetails.dislikes,u=e.videoDetails.ownerChannelName,y=e.videoDetails.uploadDate,c=e.player_response.microformat.playerMicroformatRenderer.thumbnail.thumbnails[0].url;t({creator:"Caliph",title:l,result:o,quality:a[0].quality,size:a[0].size,duration:a[0].duration,thumb:c,views:r,likes:s,dislike:d,channel:u,uploadDate:y,desc:n})})).catch(i)}))}function ytMp3(e){return new Promise(((t,i)=>{ytdl.getInfo(e).then((async e=>{let i=[];for(let t=0;t<e.formats.length;t++){let a=e.formats[t];if('audio/webm; codecs="opus"'==a.mimeType){let{contentLength:e,approxDurationMs:o}=a,l=await bytesToSize(e);i[t]={audio:a.url,size:l,duration:formated(parseInt(o))}}}let a=i.filter((e=>null!=e.audio&&null!=e.size)),o=a[0].audio,l=e.videoDetails.title,n=e.videoDetails.description,r=parseInt(e.videoDetails.viewCount||0),s=e.videoDetails.likes,d=e.videoDetails.dislikes,u=e.videoDetails.ownerChannelName,y=e.videoDetails.uploadDate,c=e.player_response.microformat.playerMicroformatRenderer.thumbnail.thumbnails[0].url;t({creator:"Caliph",title:l,result:o,size:a[0].size,duration:a[0].duration,thumb:c,views:r,likes:s,dislike:d,channel:u,uploadDate:y,desc:n})})).catch(i)}))}function ytPlay(e){return new Promise(((t,i)=>{yts(e).then((async e=>{let i=e.videos.slice(0,5),a=[];for(let e=0;e<i.length;e++)a.push(i[e].url);let o=a[0],l=await ytMp3(o);t(l)})).catch(i)}))}function ytPlayVid(e){return new Promise(((t,i)=>{yts(e).then((async e=>{let i=e.videos.slice(0,5),a=[];for(let e=0;e<i.length;e++)a.push(i[e].url);let o=a[0],l=await ytMp4(o);t(l)})).catch(i)}))}function formated(e){return[isNaN(e)?"--":Math.floor(e/36e5),isNaN(e)?"--":Math.floor(e/6e4)%60,isNaN(e)?"--":Math.floor(e/1e3)%60].map((e=>e.toString().padStart(2,0))).join(":")}module.exports={ytmp4:ytMp4.bind(),ytmp3:ytMp3.bind(),ytplay:ytPlay.bind(),ytplayvid:ytPlayVid.bind()};