const fetch=require("node-fetch"),cheerio=require("cheerio"),cookie=require("cookie"),FormData=require("form-data"),uploadFile=require("./tools/uploadFile");async function post(e,t={},o){let r=encodeURIComponent;var a=Object.keys(t).map((e=>{let o=t[e];var a,i=Array.isArray(o),n=r(e+(i?"[]":""));let c=[];for(a of o=i?o:[o])c.push(n+"="+r(a));return c.join("&")})).join("&");return fetch(e+"?"+a,{method:"GET",headers:{Accept:"*/*","Accept-Language":"en-US,en;q=0.9","User-Agent":"GoogleBot",Cookie:o}})}async function textpro(e,t){if(console.log("Scraping textpro.me"),!/^https:\/\/textpro\.me\/.+\.html$/.test(e))throw new Error("Url Salah!!");const o=await fetch(e,{method:"GET",headers:{"User-Agent":"GoogleBot"}});var r=await o.text(),a={__cfduid:(a=o.headers.get("set-cookie").split(",").map((e=>cookie.parse(e))).reduce(((e,t)=>({...e,...t})),{})).__cfduid,PHPSESSID:a.PHPSESSID};a=Object.entries(a).map((([e,t])=>cookie.serialize(e,t))).join("; ");var i;r=cheerio.load(r)('input[name="token"]').attr("value");const n=new FormData;for(i of t="string"==typeof t?[t]:t)n.append("text[]",i);n.append("submit","Go"),n.append("token",r),n.append("build_server","https://textpro.me"),n.append("build_server_id",1);const c=await fetch(e,{method:"POST",headers:{Accept:"*/*","Accept-Language":"en-US,en;q=0.9","User-Agent":"GoogleBot",Cookie:a,...n.getHeaders()},body:n.getBuffer()});if(t=await c.text(),!(r=/<div.*?id="form_value".+>(.*?)<\/div>/.exec(t)))throw new Error("Token Tidak Ditemukan!!");const s=await post("https://textpro.me/effect/create-image",JSON.parse(r[1]),a);return e=await s.json(),console.log("Success Scraping textpro.me"),linkimg="https://textpro.me"+e.fullsize_image,buffer=await(await fetch(linkimg,{headers:{"User-Agent":"GoogleBot"}})).buffer(),uploadFile(buffer)}module.exports=textpro.bind();